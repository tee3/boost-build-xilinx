import ../../xsdk ;

local xsdk-root = [ xsdk.root ] ;

local hdf = $(xsdk-root)/data/embeddedsw/lib/hwplatform_templates/ZCU102_hw_platform/system.hdf ;

local variant-desired = debug release ;
local target-os-desired = elf freertos xilkernel ;
local processor-desired = cortex-a53 cortex-r5 ;

# @todo add more configurations
xsdkws elf-ws
  : # sources
    $(hdf)
  : # requirements
    <target-os>elf

    <link>static

    <xsdk-library>xilffs

    <xsdk-configuration>"sleep_timer psu_ttc_3"
  : # default-build
  : # usage-requirements
  ;

# @todo add more configurations
xsdkws freertos-ws
  : # sources
    $(hdf)
  : # requirements
    <target-os>freertos

    <link>static

    <xsdk-library>xilffs
  : # default-build
  : # usage-requirements
  ;

# @todo add more configurations
xsdkws xilkernel-ws
  : # sources
    $(hdf)
  : # requirements
    <target-os>xilkernel

    <link>static

    <xsdk-library>xilffs
  : # default-build
  : # usage-requirements
  ;

for local variant in $(variant-desired)
{
  for local target-os in $(target-os-desired)
  {
    for local processor in $(processor-desired)
    {
      exe example-$(variant)-$(target-os)-$(processor)
        : # sources
          ../example.cpp

          $(target-os)-ws
        : # requirements
          <variant>$(variant)

          <target-os>$(target-os)

          <processor>$(processor)

          <processor>cortex-a53:<toolset>gcc-7xilinxaarch64
          <processor>cortex-r5:<toolset>gcc-7xilinxarmr5
        : # default-build
        : # usage-requirements
        ;
    }
  }
}
