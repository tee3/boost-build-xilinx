# Copyright 2019 Thomas Brown
# Distributed under the Boost Software License, Version 1.0. (See
# accompanying file LICENSE_1_0.txt or copy at
# http://www.boost.org/LICENSE_1_0.txt)

import feature ;

import xsdk ;

import errors ;

# generate a composite feature for all combinations
local target-os-values = elf ;
local architecture-values = "" arm ;
local instruction-set-values = cortex-a9 cortex-a9+vfpv3 cortex-a53 cortex-r5 cortex-r5+vfpv3-d16 ;
local floating-point-abi-values = hard softfp soft "" ;

feature.feature platform
  :
    # defined below
  :
    optional
    composite
    propagated
    link-incompatible
  ;

for local target-os in $(target-os-values)
{
  for local architecture in $(architecture-values)
  {
    for local instruction-set in $(instruction-set-values)
    {
      for local floating-point-abi in $(floating-point-abi-values)
      {
        local platform = $(target-os)-$(architecture)-$(instruction-set)-$(floating-point-abi) ;

        feature.extend platform : $(platform) ;

        feature.compose <platform>$(platform)
          : # composite-properties
            <target-os>$(target-os)
            <architecture>$(architecture)
            <instruction-set>$(instruction-set)
            <floating-point-abi>$(floating-point-abi)
          ;
      }
    }
  }
}

project
  : default-build
    <variant>debug
    <variant>release
  ;

local xsdk-root = [ xsdk.root ] ;

if ! $(xsdk-root)
{
  errors.user-error "The XSDK root is not set." ;
}

path-constant zc702-hdf : $(xsdk-root)/data/embeddedsw/lib/spm_templates/SPM_ZC_702_HwPlatform/system.hdf ;
path-constant zcu102-hdf : $(xsdk-root)/data/embeddedsw/lib/spm_templates/SPM_ZCU_102_HwPlatform/system.hdf ;

build-project configure ;

build-project zc702-empty ;

build-project zcu102-empty ;
build-project zcu102-hello ;
build-project zcu102-complex ;
